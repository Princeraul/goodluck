{"version":3,"sources":["common.min.js"],"names":["ConsumerBaseQuery","this","$loading","$","$dialog","$promptBox","$dialogContent","$qrcodeanimation","interAjax","url","data","post","backData","status","showPrompt","info","msg","$btnPointsEntityAffirm","html","attr","$btnPromptReload","on","window","location","href","reload_url","checkAdressForm","each","$this","val","value","parent","find","text","replace","entityError","prop","match","$entityError","cityChange","my","type","city_url","i","id","name","hide","append","show","ajaxData","speed","activate","document","storage","localStorage","$inpTelphone","$btnDraw","$hideDialog","$pointsTips","$pointsTipsClose","$btnPrizeAddress","$btnPrizeAddressBack","$btnPrompt","$btnPrizeVirtual","$btnPrizeAffirm","$btnPointsAffirm","telephone","prototype","showLoading","css","hideLoading","showDialog","addClass","hideDialog","removeClass","showQrcodeAnimation","hideQrcodeAnimation","click","icon","selectToggle","option","obj","toggleClass","siblings","hasClass","btnEle","setTimeout","fadeIn","fadeOut","isWritePhone","length","drawUrl","code","errorURL","prizeUrl","addressURL","serialize","sendData","$activeEle","sendId","stytem","URL","url_before","url_after","$prizePromptTxt","prizeStatus","hasOwnProperty"],"mappings":"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","file":"common.min.js","sourcesContent":["'use strict';\r\n\r\nvar ajaxData;\r\nvar speed = 2000;\r\nvar activate = \"createTouch\" in document ? \"touchend\" : \"click\";\r\nvar storage = window.localStorage;\r\n\r\n// 执行方法元素变量集合\r\nvar $inpTelphone = $('.inp-telphone');\r\nvar $btnDraw = $('.btn-draw');\r\nvar $hideDialog = $('.dialog-fade');\r\nvar $pointsTips = $('.points-header');\r\nvar $pointsTipsClose = $('.points-header span');\r\n\r\n// 实物领奖按钮\r\nvar $btnPrizeAddress = $('.btn-prize[data-name=\"btn-address\"]');\r\n// 实物返回按钮\r\nvar $btnPrizeAddressBack = $('.btn-back');\r\n\r\n// 温馨提示弹出框确认按钮\r\nvar $btnPrompt = $('.btn-prompt[data-name=\"prize-prompt\"]');\r\nvar $btnPromptReload = $('.btn-prompt[data-name=\"points-prompt\"]');\r\n\r\n// 虚拟领奖按钮\r\nvar $btnPrizeVirtual = $('.btn-prize[data-name=\"btn-virtual\"]');\r\nvar $entityError = $('.entity-error');\r\n// prize实物提交\r\nvar $btnPrizeAffirm = $('.btn-affirm[data-name=\"btn-prize-affirm\"]');\r\n\r\n// points 提交\r\nvar $btnPointsAffirm = $('input[data-name=\"btn-points-affirm\"]');\r\n// points 实物提交按钮\r\nvar $btnPointsEntityAffirm = $('.btn-affirm[data-name=\"btn-points-entity-affirm\"]');\r\n\r\n// 判断是否存储storage\r\nif (storage.telephone !== 'undefined') {\r\n    $('.inp-telphone').val(storage.telephone);\r\n}\r\n\r\n// C端public构造函数\r\nfunction ConsumerBaseQuery() {\r\n    this.$loading = $('.loading');\r\n    this.$dialog = $('.dialog');\r\n    this.$promptBox = $('.prompt-box');\r\n    this.$dialogContent = $('.dialog-content');\r\n    this.$qrcodeanimation = $('.qrcodeanimation');\r\n}\r\n\r\nConsumerBaseQuery.prototype = {\r\n    // show loadig animation\r\n    showLoading: function() {\r\n        this.$loading.css('display', 'block');\r\n    },\r\n    // hide loadig animation\r\n    hideLoading: function() {\r\n        this.$loading.css('display', 'none');\r\n    },\r\n    // show dialog\r\n    showDialog: function(text) {\r\n        this.$dialog.addClass('dialog-active');\r\n        this.$dialogContent.addClass('element-active').find('span').html(text);\r\n    },\r\n    // hide dialog\r\n    hideDialog: function() {\r\n        this.$dialog.removeClass('dialog-active');\r\n        this.$promptBox.removeClass('element-active');\r\n        this.$dialogContent.removeClass('element-active');\r\n    },\r\n    showQrcodeAnimation: function() {\r\n        this.$dialog.addClass('dialog-active');\r\n        this.$qrcodeanimation.addClass('qrcode-active');\r\n    },\r\n    hideQrcodeAnimation: function() {\r\n        this.$dialog.click(function() {\r\n            $(this).removeClass('dialog-active');\r\n            this.$qrcodeanimation.removeClass('qrcode-active');\r\n        });\r\n    },\r\n    entityError: function(text) {\r\n        $entityError.html(text).css('display', 'block');\r\n    },\r\n    // show prompt\r\n    showPrompt: function(text, icon){\r\n        this.$dialog.addClass('dialog-active');\r\n        this.$promptBox.addClass('element-active');\r\n        this.$promptBox.find('.prompt-box-cot span').removeClass().addClass(icon);\r\n        this.$promptBox.find('.prompt-box-cot p').html(text);\r\n    },\r\n    // points 积分选择toggleClass\r\n    selectToggle: function(option){\r\n        $(option.obj).on('click', function() {\r\n            $(this).toggleClass('active').siblings().removeClass('active');\r\n            if($(option.obj).hasClass('active')) {\r\n                option.btnEle.removeClass('btn-gray').addClass('btn-affirm').attr('disabled', false);\r\n            }else {\r\n                option.btnEle.removeClass('btn-affirm').addClass('btn-gray').attr('disabled', true);\r\n            }\r\n        });\r\n    }\r\n};\r\n\r\n// points 积分兑换 ajax请求模块\r\nfunction interAjax(url, data){\r\n    $.post(url, data, function(backData){\r\n        if(backData.status) {\r\n            ConsumerBaseQuery.showPrompt(backData.info.msg, 'icon-right');\r\n        }else {\r\n            ConsumerBaseQuery.showPrompt(backData.info.msg, 'icon-colse');\r\n        }\r\n        $btnPointsEntityAffirm.html('确认提交').attr('disabled', false);\r\n        $btnPromptReload.on('click', function() {\r\n            window.location.href = reload_url;\r\n        });\r\n    });\r\n}\r\n\r\n// address check\r\nfunction checkAdressForm() {\r\n\r\n    $.each($('form :input'), function() {\r\n        var $this = $(this).attr('data-name');\r\n        if($this === 'isEmpty') {\r\n            if($(this).val() === ''){\r\n                var value = $(this).parent().find('span').text().replace(':', '');\r\n                ConsumerBaseQuery.entityError(value + '填写不正确');\r\n                return false;\r\n            }\r\n        }else if($this === 'isSelectEmpty') {\r\n            if($(this).prop('selectedIndex') === 0) {\r\n                ConsumerBaseQuery.entityError('请填写正确的地址信息');\r\n                return false;\r\n            }\r\n        }else if($this === 'isTelphone') {\r\n            if(!$(this).val().match(/^1[3|4|5|7|8]\\d{9}$/)){\r\n                ConsumerBaseQuery.entityError('手机号填写不正确');\r\n                return false;\r\n            }\r\n        }else {\r\n            $entityError.html('');\r\n        }\r\n    });\r\n}\r\n\r\n// 城市切换\r\nfunction cityChange(my, type) {\r\n    if ($(my).val() === 0) return false;\r\n    $.post(city_url, 'city=1&id=' + $(my).val(), function(msg) {\r\n        var html = '';\r\n        for (var i in msg.info.data) {\r\n            html += '<option value=\"' + msg.info.data[i].id + '\">' + msg.info.data[i].name + '</option>';\r\n        }\r\n        $('#county').hide().find('select').html('<option value=\"0\">请选择区县</option>');\r\n        switch (type) {\r\n            case 0:\r\n                $('#city').html('<option value=\"0\">请选择市区</option>');\r\n                $('#city').append(html);\r\n            break;\r\n            case 1:\r\n                if (html !== '') {\r\n                    $('#county').show().find('select').append(html);\r\n                }\r\n            break;\r\n        }\r\n    });\r\n}\r\n\r\n// 实例化ConsumerBaseQuery方法\r\nvar ConsumerBaseQuery = new ConsumerBaseQuery();\r\n\r\n$(function() {\r\n    // .dialog-fade 绑定隐藏方法\r\n    $hideDialog.on(activate, function() {\r\n        ConsumerBaseQuery.hideDialog();\r\n    });\r\n\r\n    // 温馨提示点击关闭dialog\r\n    $btnPrompt.on(activate, function() {\r\n        ConsumerBaseQuery.hideDialog();\r\n    });\r\n\r\n    // 积分header浮层\r\n    setTimeout(function() {\r\n        $pointsTips.fadeIn(1200);\r\n    }, 300);\r\n\r\n    $pointsTipsClose.on(activate, function() {\r\n        setTimeout(function() {\r\n            $pointsTips.fadeOut(1200);\r\n        }, 300);\r\n    });\r\n\r\n    $btnDraw.on(activate, function() {\r\n        ajaxData = isWritePhone ? 'phone=' + $inpTelphone.val() : 'phone=';\r\n\r\n        // 判断流程是否需要输入手机号码\r\n        if ($($inpTelphone).length > 0) {\r\n            if ((!$($inpTelphone).val().match(/^1[3|4|5|7|8]\\d{9}$/))) {\r\n                ConsumerBaseQuery.showDialog('请输入正确的手机号码');\r\n                return false;\r\n            }\r\n        }\r\n\r\n        // 执行抽奖动画\r\n        ConsumerBaseQuery.showLoading();\r\n        setTimeout(function() {\r\n            $.post(drawUrl, ajaxData, function(msg){\r\n                if (msg.info.code < 0) {\r\n                    window.location.href = errorURL + '/error.html?error=' + msg.info.code;\r\n                    return false;\r\n                } else {\r\n                    window.location.href = prizeUrl + '&city[shenid]=0&city[shiid]=0&city[quid]=0&address=&phone=';\r\n                }\r\n                storage.telephone = $inpTelphone.val();\r\n                // 隐藏hideloading\r\n                // ConsumerBaseQuery.hideLoading();\r\n            });\r\n        }, speed);\r\n    });\r\n\r\n    $btnPrizeAddress.on(activate, function() {\r\n        $('.md-address').addClass('md-address-visible');\r\n    });\r\n    $btnPrizeAddressBack.on(activate, function() {\r\n        $('.md-address').removeClass('md-address-visible');\r\n        $btnPointsAffirm.attr('disabled', false).val('立即兑换');\r\n    });\r\n\r\n    //领奖实物提交信息\r\n    $btnPrizeAffirm.on(activate, function() {\r\n        checkAdressForm();\r\n        if ($entityError.html() === '') {\r\n            $(this).html('正在提交中...').attr('disabled');\r\n            window.location.href = 'index.php?s=/' + addressURL + '.html&' + $('form').serialize();\r\n        }\r\n    });\r\n\r\n    // 积分points select toggleClass 暂时都用jq $选中\r\n    ConsumerBaseQuery.selectToggle({\r\n        obj: $('.intergral-item li'),\r\n        btnEle: $btnPointsAffirm\r\n    });\r\n\r\n    // 积分points 兑换红包和实物\r\n    $btnPointsAffirm.on('click', function() {\r\n        var sendData;\r\n        var $activeEle = $('.intergral-item li.active');\r\n        var sendId = $activeEle.attr('data-id');\r\n        var stytem = $activeEle.attr('data-stytem');\r\n        var URL    = url_before + sendId + url_after;\r\n\r\n        $(this).val('正在提交中...').attr('disabled', true);\r\n\r\n        if(stytem === '1') {\r\n            $('.md-address').addClass('md-address-visible');\r\n            $btnPointsEntityAffirm.on(activate, function() {\r\n                checkAdressForm();\r\n                if ($entityError.html() === '') {\r\n                    sendData = $('form').serialize();\r\n                    $(this).html('正在提交中...').attr('disabled');\r\n                    interAjax(URL, sendData);\r\n                }\r\n            });\r\n        }else {\r\n            sendData = '';\r\n            interAjax(URL, sendData);\r\n        }\r\n    });\r\n\r\n    // 红包和积分根据实际情况手动修改\r\n    $btnPrizeVirtual.on(activate, function() {\r\n        var $prizePromptTxt = $('.prizePromptTxt').html();\r\n        if(prizeStatus.hasOwnProperty('action').hasOwnProperty('focus')) {\r\n            ConsumerBaseQuery.showQrcodeAnimation();\r\n            ConsumerBaseQuery.hideQrcodeAnimation();\r\n        }else {\r\n            ConsumerBaseQuery.showPrompt($prizePromptTxt, 'icon-right');\r\n        }\r\n    });\r\n});\r\n"],"sourceRoot":"/source/"}